---
title: "MUI v5 ã¨React Hook Form v7 ã‚’é€£æºã•ã›ã‚‹éš›ã®è¨­è¨ˆã¨å®Ÿè£…ä¾‹ã®ç´¹ä»‹"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "reacthookform", "mui", "typescript"]
published: true
published_at: 2023-05-21 18:00 
publication_name: "buyselltech"
---

ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§MUIã¨React Hook Formï¼ˆä»¥ä¸‹RHFï¼‰ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¨­è¨ˆã«é–¢ã—ã¦ä½•ã‚‚ãƒ«ãƒ¼ãƒ«ãŒæ•´å‚™ã•ã‚Œã¦ãŠã‚‰ãšã€å®Ÿè£…ãŒè¤‡é›‘ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚ãã®ãŸã‚ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒã—ã¥ã‚‰ã‹ã£ãŸã‚Šã€æ±ç”¨çš„ã«ä½¿ã„ã¥ã‚‰ã„çŠ¶æ…‹ã§ã—ãŸã€‚ãã“ã§ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¨­è¨ˆã®è¦‹ç›´ã—ã‚’è¡Œãªã£ãŸçµæœã€ã„ã„æ„Ÿã˜ã®è¨­è¨ˆãŒã§ããŸã®ã§ã€ä»Šå›ã¯ãã®è¨­è¨ˆã¨å®Ÿè£…ä¾‹ã‚’ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ï¼

# åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

Reactã«ã¯åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®2ã¤ã®ã‚¿ã‚¤ãƒ—ãŒå­˜åœ¨ã—ã¾ã™ã€‚åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›å€¤ã‚„çŠ¶æ…‹ã‚’Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè‡ªä½“ã§ç®¡ç†ã—ã¾ã™ã€‚ä¸€æ–¹ã€éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›å€¤ã‚„çŠ¶æ…‹ã‚’DOMè¦ç´ è‡ªä½“ãŒç®¡ç†ã—ã¾ã™ã€‚
RHFã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€é€šå¸¸ã¯[register](https://react-hook-form.com/api/useform/register)ã‚’ä½¿ç”¨ã—ã¦éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ‰±ã†ã“ã¨ã§ã€ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ãŒå¤‰ã‚ã£ãŸéš›ã‚‚å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒèµ°ã‚‰ãšã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå‘ä¸Šã—ã¾ã™ã€‚
ãŸã ã—MUIã¯åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åˆ†é¡ã•ã‚Œã¾ã™ã€‚ãã®ãŸã‚ã€MUIã¨RHFã‚’é€£æºã™ã‚‹éš›ã¯ã€RHFãŒå¤–éƒ¨ã®åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨é€£æºã™ã‚‹ãŸã‚ã«æä¾›ã—ã¦ã„ã‚‹[Controller](https://react-hook-form.com/docs/usecontroller/controller)ã‚„[useController](https://react-hook-form.com/docs/usecontroller)ã‚’ä½¿ç”¨ã—ã¦é€£æºã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
ã—ã‹ã—ã€MUIã§ã‚‚TextFieldãªã©ã¯`register`ã‚’ä½¿ç”¨ã—ã¦ã€éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦é€£æºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å…ˆè¿°ã—ãŸé€šã‚Šã€éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ‰±ã†æ–¹ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®å›æ•°ãŒæ¸›ã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚‚å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ãã®ãŸã‚RHFã¨MUIã‚’é€£æºã•ã›ã‚‹éš›ã®æ–¹é‡ã¨ã—ã¦ã€éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦é€£æºã§ãã‚‹ã‚‚ã®ã¯å„ªå…ˆã—ã¦éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦é€£æºã—ã€éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦é€£æºãŒé›£ã—ã„å ´åˆã¯åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦é€£æºã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
ï¼ˆåˆ¶å¾¡ãƒ»éåˆ¶å¾¡ã®ã©ã¡ã‚‰ã¨ã—ã¦é€£æºã™ã‚‹ã‹ã«ã‚ˆã£ã¦ã€`register`ã¨`Controller`ã‚’ä½¿ã„åˆ†ã‘ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…¨ä½“ã§çµ±ä¸€æ„Ÿã‚’æŒãŸã›ã‚‹ã¨ã„ã†ç›®çš„ã§ã€åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§çµ±ä¸€ã™ã‚‹ã®ã‚‚ã‚ã‚Šã‹ãªã¨æ€ã„ã¾ã™ã€‚ï¼‰

# ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é¡

ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’Viewã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨Controllerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®2ã¤ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åˆ†ã‘ã¦å®Ÿè£…ã™ã‚‹è¨­è¨ˆæ–¹é‡ã«ã—ã¦ã„ã¾ã™ã€‚
ã“ã®è¨­è¨ˆæ–¹é‡ã¯ãƒãƒŠãƒªãƒ³ã‚¯ã•ã‚“ã®ä¸‹è¨˜ã®è¨˜äº‹ã‚’ã‹ãªã‚Šå‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚
https://zenn.dev/manalink_dev/articles/manalink-react-hook-form-v7

## Viewã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

è¦‹ãŸç›®ã«é–¢ã™ã‚‹é–¢å¿ƒã®ã¿ã‚’æŒã¤ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚åŸºæœ¬çš„ã«ã¯MUIã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã ã‘ã§ã™ã€‚ã‚µãƒ³ãƒ—ãƒ«ã§ã¯MUIã®Propsã‚’å…¨ã¦å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã¾ã™ãŒã€å—ã‘å–ã‚Œã‚‹Propsã‚’çµã‚‹ã“ã¨ã§ã€å‘¼ã³å‡ºã—å…ƒã§ä¸Šæ›¸ãå¯èƒ½ãªæŒ™å‹•ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§åˆ¶å¾¡ã§ãã¾ã™ã€‚
ã¾ãŸã€[bulletproof-react](https://github.com/alan2207/bulletproof-react)ã‚’å‚è€ƒã«ã—ã¦ã€`FieldWrapper`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®šç¾©ã—ã¦ã€ãƒ©ãƒ™ãƒ«ã‚„ã‚¨ãƒ©ãƒ¼æ–‡ãªã©ã®è¡¨ç¤ºã‚’å…±é€šåŒ–ã—ã¦ã„ã¾ã™ã€‚
Storybookã¯ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¯¾ã—ã¦ã®ã¿ä½œæˆã—ã¾ã™ã€‚ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åˆ†ã‘ã‚‹å‰ã¯Storybookã®ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§`useForm`ã®å‘¼ã³å‡ºã—ã‚’è¡Œã‚ãªã„ã¨ã„ã‘ãªã‹ã£ãŸã®ã§ã™ãŒã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åˆ†ã‘ã‚‹ã“ã¨ã«ã‚ˆã£ã¦RHFã¸ã®ä¾å­˜ãŒãªããªã£ãŸã®ã§ã€Storybookã®ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§`useForm`ã‚’å‘¼ã³å‡ºã™å¿…è¦ãŒãªããªã‚Šã€StorybookãŒä½œæˆã—ã‚„ã™ããªã‚Šã¾ã—ãŸã€‚

```tsx:FieldWrapper.tsx
import Box from '@mui/material/Box';
import FormControl from '@mui/material/FormControl';
import Typography from '@mui/material/Typography';
import { PropsWithChildren } from 'react';

type FieldWrapperProps = PropsWithChildren<{
  label: string;
  required?: boolean;
  errorMessage?: string;
}>;

export type FieldWrapperPassThroughProps = Omit<FieldWrapperProps, 'children'>;

export const FieldWrapper: React.FC<FieldWrapperProps> = ({
  label,
  required,
  errorMessage,
  children,
}) => {
  return (
    <FormControl fullWidth error={!!errorMessage}>
      <Box sx={{ display: 'flex', flexDirection: 'column', gap: 0.5 }}>
        <Box sx={{ display: 'flex', gap: 0.5 }}>
          <Typography sx={{ fontSize: 20 }}>{label}</Typography>
          {required && (
            <Typography color="error" fontSize={12}>
              â€»å¿…é ˆ
            </Typography>
          )}
        </Box>
        {children}
        {errorMessage && (
          <Typography color="error" fontSize={12}>
            {errorMessage}
          </Typography>
        )}
      </Box>
    </FormControl>
  );
};
```

```tsx
import MuiTextField, {
  TextFieldProps as MuiTextFieldProps,
} from '@mui/material/TextField';
import { FieldWrapper, FieldWrapperPassThroughProps } from './FieldWrapper';

export type TextFieldProps = {
  fieldWrapper: FieldWrapperPassThroughProps;
  muiTextField?: MuiTextFieldProps;
};

export const TextField: React.FC<TextFieldProps> = ({
  fieldWrapper,
  muiTextField,
}) => {
  return (
    <FieldWrapper {...fieldWrapper}>
      <MuiTextField {...muiTextField} error={!!fieldWrapper.errorMessage} />
    </FieldWrapper>
  );
};
```

## Controllerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

RHFã¨Viewã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã¤ãªãã“ã¿ã‚’è¡Œã†ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚RHFã¨ã®é€£æºã«å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’Viewã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã™å½¹å‰²ã‚’æ‹…ã„ã¾ã™ã€‚åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã£ã¦ã€å®Ÿè£…ãŒè‹¥å¹²ç•°ãªã‚Šã¾ã™ã€‚

### éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å ´åˆ

`register`ã®è¿”ã‚Šå€¤ã‚’Propsã¨ã—ã¦å—ã‘å–ã‚Šã€ãã®ã¾ã¾Viewã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Propsã«æ¸¡ã—ã¾ã™ã€‚éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å ´åˆã¯Viewã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç›´æ¥å‘¼ã³å‡ºã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãŸã ã€éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚‚Controllerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚
- ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹éš›ã¯ã€åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åŒºåˆ¥ã«é–¢ä¿‚ãªãã€Controllerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™ã¨ã„ã†çµ±ä¸€ã®ãƒ«ãƒ¼ãƒ«ã«ã§ãã‚‹
- éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã®é€£æºã«å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’Controllerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Propsã¨ã—ã¦å®šç¾©ã§ãã‚‹ã®ã§ã€å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ˜ç¢ºã«ã§ãã‚‹

```tsx
import {
  FieldPathByValue,
  FieldValues,
  UseFormRegisterReturn,
} from 'react-hook-form';

import { TextField, TextFieldProps } from './TextField';

type TextFieldControllerProps<TFieldValues extends FieldValues> = {
  registration: UseFormRegisterReturn<FieldPathByValue<TFieldValues, string>>;
  textField: TextFieldProps;
};

export const TextFieldController = <TFieldValues extends FieldValues>({
  registration,
  textField: { fieldWrapper, muiTextField },
}: TextFieldControllerProps<TFieldValues>): JSX.Element => {
  return (
    <TextField
      fieldWrapper={fieldWrapper}
      muiTextField={{
        ...muiTextField,
        ...registration,
      }}
    />
  );
};
```

### åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å ´åˆ

`useController`ã®Propsã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Propsã¨ã—ã¦å—ã‘å–ã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…éƒ¨ã§`useController`ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ãã—ã¦`useController`ã®è¿”ã‚Šå€¤ã‚’Viewã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é©åˆ‡ãªPropsã«æ¸¡ã—ã¾ã™ã€‚


```tsx
import {
  FieldPathByValue,
  FieldValues,
  useController,
  UseControllerProps,
} from 'react-hook-form';

import { Select, SelectProps } from './Select';

type SelectControllerProps<
  TFieldValues extends FieldValues,
  TValue extends number | string | '',
> = {
  controller: UseControllerProps<
    TFieldValues,
    FieldPathByValue<TFieldValues, TValue>
  >;
  select: SelectProps<TValue>;
};

export const SelectController = <
  TFieldValues extends FieldValues,
  TValue extends number | string | '' = number | '',
>({
  controller,
  select: { fieldWrapper, muiTextField, options },
}: SelectControllerProps<TFieldValues, TValue>): JSX.Element => {
  const {
    field,
    fieldState: { error },
  } = useController(controller);

  return (
    <Select
      fieldWrapper={{
        ...fieldWrapper,
        errorMessage: error?.message,
      }}
      muiTextField={{
        ...muiTextField,
        ...field,
      }}
      options={options}
    />
  );
};
```

# å‹å®šç¾©

## FieldPathByValueã®åˆ©ç”¨

Controllerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Propsã«å«ã¾ã‚Œã‚‹RHFé–¢é€£ã®å‹å®šç¾©ã«ã¯ã€`FieldPathByValue`ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```ts
type TextFieldControllerProps<TFieldValues extends FieldValues> = {
  registration: UseFormRegisterReturn<FieldPathByValue<TFieldValues, string>>;
  textField: TextFieldProps;
};

type SelectControllerProps<
  TFieldValues extends FieldValues,
  TValue extends number | string | '',
> = {
  controller: UseControllerProps<
    TFieldValues,
    FieldPathByValue<TFieldValues, TValue>
  >;
  select: SelectProps<TValue>;
};
```

`FieldPathByValue`ã¯ã€ç¬¬ä¸€ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã«æŒ‡å®šã—ãŸãƒ•ã‚©ãƒ¼ãƒ ã®å‹ã‹ã‚‰ã€ç¬¬äºŒã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã«æŒ‡å®šã—ãŸå‹ã‚’å€¤ã¨ã—ã¦æŒã¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ‘ã‚¹ã‚’è¿”ã™å‹å®šç¾©ã§ã™ã€‚

```ts
type Form = {
  name: string;
  age: number;
  email: string;
};

// FieldPathByValueã‚’ä½¿ç”¨ã—ã¦ã€å€¤ãŒstringå‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ‘ã‚¹ã‚’å–å¾—ã™ã‚‹
type StringFieldPath = FieldPathByValue<Form, string>;
// çµæœ: "name" | "email"

// FieldPathByValueã‚’ä½¿ç”¨ã—ã¦ã€å€¤ãŒnumberå‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ‘ã‚¹ã‚’å–å¾—ã™ã‚‹
type NumberFieldPath = FieldPathByValue<Form, number>;
// çµæœ: "age"
```

Controllerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Propsã§ä½¿ç”¨ã—ã¦ã„ã‚‹`UseFormRegisterReturn`ã‚„`UseControllerProps`ã®ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã«`FieldPathByValue`ã‚’ä½¿ç”¨ã—ãŸå‹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ãã†ã™ã‚‹ã“ã¨ã§ã€ãã®ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ‰±ã†å€¤ã®å‹ã‚’æŒã¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä»¥å¤–ã§ä½¿ç”¨ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã®ã§å‹å®‰å…¨ã«æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx
type Form = {
  name: string;
  age: number;
  email: string;
};

const App = () => {
  const { register } = useForm<Form>();

  return (
    <>
      {/* OK */}
      <TextFieldController<Form>
        registration={register('name')}
        textField={{ fieldWrapper: { label: 'TextField' } }}
      />
      {/* NG */}
      <TextFieldController<Form>
        // stringä»¥å¤–ã®å‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒ‡å®šã—ã¦ã„ã‚‹
        registration={register('age')}
        textField={{ fieldWrapper: { label: 'TextField' } }}
      />
    </>
  );
};
```

## é¸æŠè‚¢ç³»ã®å‹å®šç¾©

é¸æŠè‚¢ç³»ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ã€valueã®å‹ã‚’ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§å—ã‘å–ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚é¸æŠè‚¢ã®valueã«ä½¿ç”¨ã™ã‚‹å€¤ã¯ã€ä½¿ç”¨å ´é¢ã«ã‚ˆã£ã¦stringã¨numberã®ã©ã¡ã‚‰ã‹ã‚’ä½¿ã„åˆ†ã‘ãŸã„ã§ã™ã€‚ãã®ãŸã‚ã€ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§å—ã‘å–ã‚‹ã“ã¨ã§ã€é€”ä¸­ã§å‹å¤‰æ›ã®å‡¦ç†ã‚’æŒŸã‚€ã“ã¨ãªããªã‚Šã€valueã‚’æ‰±ã„ã‚„ã™ãã—ã¦ã„ã¾ã™ã€‚

```ts
export type Option<T> = { label: string; value: T };
export type Options<T> = Option<T>[];

export type SelectProps<T extends number | string = number> = {
  fieldWrapper: FieldWrapperPassThroughProps;
  muiTextField?: TextFieldProps;
  options: Options<T>;
};
```

# å®Ÿè£…ä¾‹

ä¸Šè¨˜ã®æ–¹é‡ã‚’è¸ã¾ãˆãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…ã‚’ã„ãã¤ã‹è¼‰ã›ã¦ãŠãã¾ã™ã€‚å…¨ä½“åƒã¯ä¸‹è¨˜ã®ãƒªãƒã‚¸ãƒˆãƒªã«pushã—ã¦ã‚ã‚Šã¾ã™ã€‚
https://github.com/KazukiHayase/RHF-MUI-sample

:::details TextField
```tsx:TextField.tsx
import MuiTextField, {
  TextFieldProps as MuiTextFieldProps,
} from '@mui/material/TextField';
import { FieldWrapper, FieldWrapperPassThroughProps } from './FieldWrapper';

export type TextFieldProps = {
  fieldWrapper: FieldWrapperPassThroughProps;
  muiTextField?: MuiTextFieldProps;
};

export const TextField: React.FC<TextFieldProps> = ({
  fieldWrapper,
  muiTextField,
}) => {
  return (
    <FieldWrapper {...fieldWrapper}>
      <MuiTextField {...muiTextField} error={!!fieldWrapper.errorMessage} />
    </FieldWrapper>
  );
};
```

```tsx:TextFieldController.tsx
import {
  FieldPathByValue,
  FieldValues,
  UseFormRegisterReturn,
} from 'react-hook-form';

import { TextField, TextFieldProps } from './TextField';

type TextFieldControllerProps<TFieldValues extends FieldValues> = {
  registration: UseFormRegisterReturn<FieldPathByValue<TFieldValues, string>>;
  textField: TextFieldProps;
};

export const TextFieldController = <TFieldValues extends FieldValues>({
  registration,
  textField: { fieldWrapper, muiTextField },
}: TextFieldControllerProps<TFieldValues>): JSX.Element => {
  return (
    <TextField
      fieldWrapper={fieldWrapper}
      muiTextField={{
        ...muiTextField,
        ...registration,
      }}
    />
  );
};
```
:::

:::details Select
```tsx:Select.tsx
import MenuItem from '@mui/material/MenuItem';
import TextField, { TextFieldProps } from '@mui/material/TextField';

import { FieldWrapper, FieldWrapperPassThroughProps } from './FieldWrapper';
import { Options } from './types';

export type SelectProps<T extends number | string = number> = {
  fieldWrapper: FieldWrapperPassThroughProps;
  muiTextField?: TextFieldProps;
  options: Options<T>;
};

export const Select = <T extends number | string = number>({
  fieldWrapper,
  muiTextField,
  options,
}: SelectProps<T>): JSX.Element => {
  return (
    <FieldWrapper {...fieldWrapper}>
      <TextField select error={!!fieldWrapper?.errorMessage} {...muiTextField}>
        {options.map(({ label, value }) => (
          <MenuItem key={value} value={value}>
            {label}
          </MenuItem>
        ))}
      </TextField>
    </FieldWrapper>
  );
};
```

```tsx:SelectController.tsx
import {
  FieldPathByValue,
  FieldValues,
  useController,
  UseControllerProps,
} from 'react-hook-form';

import { Select, SelectProps } from './Select';

type SelectControllerProps<
  TFieldValues extends FieldValues,
  TValue extends number | string | '',
> = {
  controller: UseControllerProps<
    TFieldValues,
    FieldPathByValue<TFieldValues, TValue>
  >;
  select: SelectProps<TValue>;
};

export const SelectController = <
  TFieldValues extends FieldValues,
  TValue extends number | string | '' = number | '',
>({
  controller,
  select: { fieldWrapper, muiTextField, options },
}: SelectControllerProps<TFieldValues, TValue>): JSX.Element => {
  const {
    field,
    fieldState: { error },
  } = useController(controller);

  return (
    <Select
      fieldWrapper={{
        ...fieldWrapper,
        errorMessage: error?.message,
      }}
      muiTextField={{
        ...muiTextField,
        ...field,
      }}
      options={options}
    />
  );
};
```
:::

:::details CheckBoxGroup
```tsx:CheckBoxGroup.tsx
import Checkbox, { CheckboxProps } from '@mui/material/Checkbox';
import FormControlLabel from '@mui/material/FormControlLabel';
import FormGroup from '@mui/material/FormGroup';

import { FieldWrapper, FieldWrapperPassThroughProps } from './FieldWrapper';

export type CheckboxGroupProps = {
  fieldWrapper: FieldWrapperPassThroughProps;
  muiCheckbox?: CheckboxProps;
  options: {
    label: string;
    checked: boolean;
    onChange: () => void;
  }[];
};

export const CheckboxGroup: React.FC<CheckboxGroupProps> = ({
  fieldWrapper,
  muiCheckbox,
  options,
}) => {
  return (
    <FieldWrapper {...fieldWrapper}>
      <FormGroup row>
        {options.map(({ label, checked, onChange }) => (
          <FormControlLabel
            key={label}
            label={label}
            control={
              <Checkbox
                size="small"
                checked={checked}
                onChange={onChange}
                {...muiCheckbox}
              />
            }
          />
        ))}
      </FormGroup>
    </FieldWrapper>
  );
};
```

```tsx:CheckBoxGroupController.tsx
import {
  FieldPathByValue,
  FieldValues,
  useController,
  UseControllerProps,
} from 'react-hook-form';

import { CheckboxGroup, CheckboxGroupProps } from './CheckboxGroup';
import { Options } from './types';

type CheckboxGroupControllerProps<
  TFieldValues extends FieldValues,
  TValue extends string | number,
> = {
  controller: UseControllerProps<
    TFieldValues,
    FieldPathByValue<TFieldValues, TValue[]>
  >;
  checkboxGroup: Omit<CheckboxGroupProps, 'options'> & {
    options: Options<TValue>;
  };
};

export const CheckboxGroupController = <
  TFieldValues extends FieldValues,
  TValue extends string | number = number,
>({
  controller,
  checkboxGroup,
}: CheckboxGroupControllerProps<TFieldValues, TValue>): JSX.Element => {
  const {
    field: { value, onChange, ...field },
    fieldState: { error },
  } = useController(controller);
  // PathValue<TFieldValues, FieldPathByValue<TFieldValues, TValue[]>>ã¯TValue[]ã¨åŒç¾©
  const formValue = value as TValue[];
  const { fieldWrapper, muiCheckbox, options: checkboxOptions } = checkboxGroup;

  const handleChange = (value: TValue) => {
    const newValue = formValue.includes(value)
      ? formValue.filter((v) => v !== value)
      : [...formValue, value];
    onChange(newValue);
  };

  const options = checkboxOptions.map(({ label, value }) => ({
    label,
    value,
    checked: formValue.includes(value),
    onChange: () => handleChange(value),
  }));

  return (
    <CheckboxGroup
      fieldWrapper={{ ...fieldWrapper, errorMessage: error?.message }}
      muiCheckbox={{
        ...muiCheckbox,
        ...field,
      }}
      options={options}
    />
  );
};
```
:::

:::details MultiComboBox
```tsx:MultiComboBox.tsx
import Autocomplete, { AutocompleteProps } from '@mui/material/Autocomplete';
import TextField, { TextFieldProps } from '@mui/material/TextField';

import { FieldWrapper, FieldWrapperPassThroughProps } from './FieldWrapper';
import { Option, Options } from './types';

export type MultiComboBoxProps<T extends number | string> = {
  fieldWrapper: FieldWrapperPassThroughProps;
  muiAutoComplete?: Omit<
    AutocompleteProps<Option<T>, true, false, false>,
    'renderInput' | 'options'
  >;
  muiTextField?: TextFieldProps;
  options: Options<T>;
};

export const MultiComboBox = <T extends number | string = number>({
  fieldWrapper,
  muiAutoComplete,
  muiTextField,
  options,
}: MultiComboBoxProps<T>) => {
  return (
    <FieldWrapper {...fieldWrapper}>
      <Autocomplete<Option<T>, true, false, false>
        multiple
        filterSelectedOptions
        getOptionLabel={({ label }) => label}
        options={options}
        renderInput={(params: JSX.IntrinsicAttributes & TextFieldProps) => (
          <TextField
            {...params}
            {...muiTextField}
            error={!!fieldWrapper.errorMessage}
          />
        )}
        {...muiAutoComplete}
      />
    </FieldWrapper>
  );
};
```

```tsx:MultiComboBoxController.tsx
import {
  FieldPathByValue,
  FieldValues,
  useController,
  UseControllerProps,
} from 'react-hook-form';

import { MultiComboBox, MultiComboBoxProps } from './MultiComboBox';
import { Options } from './types';

type MultiComboBoxControllerProps<
  TFieldValues extends FieldValues,
  TValue extends number | string,
> = {
  controller: UseControllerProps<
    TFieldValues,
    FieldPathByValue<TFieldValues, Options<TValue>>
  >;
  multiComboBox: MultiComboBoxProps<TValue>;
};

export const MultiComboBoxController = <
  TFieldValues extends FieldValues,
  TValue extends number | string = number,
>({
  controller,
  multiComboBox: { fieldWrapper, muiAutoComplete, muiTextField, options },
}: MultiComboBoxControllerProps<TFieldValues, TValue>) => {
  const {
    field: { value, onChange },
    fieldState: { error },
  } = useController(controller);

  return (
    <MultiComboBox<TValue>
      fieldWrapper={{
        ...fieldWrapper,
        errorMessage: error?.message,
      }}
      muiAutoComplete={{
        ...muiAutoComplete,
        value,
        onChange: (_, value) => onChange(value),
      }}
      muiTextField={muiTextField}
      options={options}
    />
  );
};
```
:::

# ã¾ã¨ã‚

ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é¡ã¨å‹å®šç¾©ã®è¦‹ç›´ã—ã‚’ã—ãŸã“ã¨ã«ã‚ˆã£ã¦ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒã—ã‚„ã™ãã€å‹å®‰å…¨ã«æ‰±ãˆã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã¾ãŸã€ä¸€éƒ¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’éåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ‰±ã†ã“ã¨ã§ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Šã‚‚æœŸå¾…ã§ãã¾ã™ã€‚
ä½•ã‚ˆã‚Šã€è¤‡é›‘ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã«ãã‹ã£ãŸçŠ¶æ…‹ã‹ã‚‰ã€ãƒ«ãƒ¼ãƒ«ãŒæ•´å‚™ã•ã‚Œã¦ã€è¤‡æ•°äººã§ã‚‚é–‹ç™ºã—ã‚„ã™ã„çŠ¶æ…‹ã«ã§ããŸã®ãŒã‚ˆã‹ã£ãŸã§ã™ï¼
